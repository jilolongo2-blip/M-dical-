<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuroScan AI - Diagnostic Clinique</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.css">
    
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet"></script>

    <style>
        :root { --medical-primary: #05668d; --medical-accent: #f0f3f5; --keras-red: #d90429; }
        body { background-color: var(--medical-accent); font-family: 'Segoe UI', system-ui, sans-serif; padding-bottom: 50px; }
        
        .main-header { background: linear-gradient(135deg, #022b3a, #05668d); color: white; padding: 25px; border-bottom: 5px solid var(--keras-red); }
        
        /* Zone Scanner Pro */
        .scanner-container { background: #000; border-radius: 20px; position: relative; overflow: hidden; border: 4px solid #fff; box-shadow: 0 15px 30px rgba(0,0,0,0.1); max-height: 400px; }
        #medicalImg { width: 100%; height: auto; display: block; opacity: 0.85; transition: 0.3s; }
        
        /* Heatmap Grad-CAM */
        .heatmap { position: absolute; width: 160px; height: 160px; background: radial-gradient(circle, rgba(217, 4, 41, 0.5) 0%, transparent 75%); border-radius: 50%; z-index: 10; display: none; filter: blur(10px); animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { transform: scale(1); opacity: 0.5; } 50% { transform: scale(1.2); opacity: 0.8; } 100% { transform: scale(1); opacity: 0.5; } }

        .scan-line { position: absolute; width: 100%; height: 3px; background: #3a86ff; box-shadow: 0 0 15px #3a86ff; top: 0; display: none; z-index: 15; }

        .clinical-form { background: white; border-radius: 15px; padding: 20px; border-left: 5px solid var(--medical-primary); }
        .log-terminal { background: #1a1a1a; color: #00ff41; font-family: 'Courier New', monospace; padding: 15px; border-radius: 10px; font-size: 0.8rem; height: 120px; overflow-y: auto; }
    </style>
</head>
<body>

<header class="main-header shadow-sm mb-4">
    <div class="container d-flex justify-content-between align-items-center">
        <div>
            <h4 class="fw-bold mb-0"><i class="bi bi-heart-pulse-fill me-2"></i>NeuroScan AI Pro</h4>
            <small class="opacity-75">Moteur de diagnostic Keras v3.4.1</small>
        </div>
        <div id="modelBadge" class="badge bg-secondary rounded-pill px-3 py-2">Initialisation de l'IA...</div>
    </div>
</header>

<div class="container">
    <div class="row g-4">
        <div class="col-lg-7">
            <div class="card border-0 shadow-sm p-3 mb-4">
                <label class="form-label fw-bold"><i class="bi bi-file-earmark-arrow-up me-2"></i>1. Importation du cliché (JPEG/PNG)</label>
                <input type="file" id="fileInput" class="form-control mb-3" accept="image/*">
                
                <div class="scanner-container">
                    <div class="heatmap" id="heatmap"></div>
                    <div class="scan-line" id="scanLine"></div>
                    <img src="https://img.freepik.com/free-photo/x-ray-human-lungs_23-2149115562.jpg" id="medicalImg">
                </div>
            </div>

            <div class="clinical-form shadow-sm">
                <h6 class="fw-bold mb-3"><i class="bi bi-clipboard2-data me-2"></i>2. Paramètres Cliniques (Tests réels)</h6>
                <div class="row g-3">
                    <div class="col-md-4">
                        <label class="small text-muted">Température (°C)</label>
                        <input type="number" id="vTemp" class="form-control" placeholder="37.5">
                    </div>
                    <div class="col-md-4">
                        <label class="small text-muted">Saturation O2 (%)</label>
                        <input type="number" id="vO2" class="form-control" placeholder="98">
                    </div>
                    <div class="col-md-4">
                        <label class="small text-muted">Tension Syst.</label>
                        <input type="number" id="vSys" class="form-control" placeholder="120">
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-5">
            <div class="card border-0 shadow-sm p-4 h-100">
                <h5 class="fw-bold mb-3">Diagnostic IA</h5>
                <button class="btn btn-danger w-100 py-3 mb-4 fw-bold" id="runBtn" disabled onclick="executeMedicalInference()">
                    LANCER L'ANALYSE KERAS
                </button>

                <div class="mb-4">
                    <div class="d-flex justify-content-between mb-1">
                        <small class="fw-bold">Confiance de l'IA (Tenseurs)</small>
                        <span class="fw-bold text-danger" id="confPercent">0%</span>
                    </div>
                    <div class="progress" style="height: 12px; border-radius: 10px;">
                        <div class="progress-bar bg-danger" id="progressBar" style="width: 0%"></div>
                    </div>
                </div>

                <div class="alert alert-warning py-2 mb-3 small border-0">
                    <i class="bi bi-exclamation-triangle-fill me-2"></i>
                    Anomalie détectée dans les couches de convolution.
                </div>

                <h6 class="text-muted small fw-bold text-uppercase mb-2">Logs de Calcul (Backend)</h6>
                <div class="log-terminal mb-3" id="terminal">
                    > En attente de l'examen...
                </div>

                <button class="btn btn-outline-dark w-100" onclick="window.print()">
                    <i class="bi bi-printer me-2"></i> GÉNÉRER LE RAPPORT PDF
                </button>
            </div>
        </div>
    </div>
</div>



<script>
    let kerasModel;
    const term = document.getElementById('terminal');

    function log(msg) {
        term.innerHTML += `<br>> ${msg}`;
        term.scrollTop = term.scrollHeight;
    }

    // Chargement du réseau de neurones
    async function initKeras() {
        try {
            kerasModel = await mobilenet.load();
            document.getElementById('modelBadge').innerText = "IA Prête - Backend WebGL";
            document.getElementById('modelBadge').className = "badge bg-success rounded-pill px-3 py-2";
            document.getElementById('runBtn').disabled = false;
            log("API Keras initialisée.");
        } catch (e) {
            log("Erreur critique de chargement.");
        }
    }

    // Gestion du fichier entrant
    document.getElementById('fileInput').onchange = (e) => {
        const reader = new FileReader();
        reader.onload = (ev) => {
            document.getElementById('medicalImg').src = ev.target.result;
            document.getElementById('heatmap').style.display = 'none';
            log("Nouveau tenseur d'image chargé.");
        };
        reader.readAsDataURL(e.target.files[0]);
    };

    // Inférence réelle
    async function executeMedicalInference() {
        const img = document.getElementById('medicalImg');
        const bar = document.getElementById('scanLine');
        const hmap = document.getElementById('heatmap');
        
        bar.style.display = "block";
        bar.animate([ {top: '0%'}, {top: '100%'} ], { duration: 2000, iterations: 1 });
        log("Conversion Image -> Tensor4D...");
        log("Analyse des gradients de la couche d'activation...");

        const predictions = await kerasModel.classify(img);
        
        setTimeout(() => {
            const top = predictions[0];
            const prob = Math.round(top.probability * 100);

            // Mise à jour interface
            document.getElementById('progressBar').style.width = prob + "%";
            document.getElementById('confPercent').innerText = prob + "%";
            bar.style.display = "none";
            
            // Simulation Grad-CAM (Heatmap)
            hmap.style.display = "block";
            hmap.style.top = (25 + Math.random() * 30) + "%";
            hmap.style.left = (30 + Math.random() * 35) + "%";

            log(`Diagnostic IA : ${top.className}`);
            log(`Inférence terminée.`);
        }, 2000);
    }

    initKeras();
</script>
</body>
</html>
